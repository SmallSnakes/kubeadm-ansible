- name: 创建 gen-password values 目录
  file:
    name: /etc/kubernetes/plugins/gen-password
    state: directory

- name: 复制 gen-password charts 目录
  copy:
    src: "{{ item }}"
    dest: "{{ charts_dir }}/"
  loop:
    - "gen-password"

- name: 生成 gen-password values.yml
  template:
    src: custom-values-gen-password.yaml.j2
    dest: /etc/kubernetes/plugins/gen-password/values.yaml
    owner: root
    mode: 0644

- name: 安装 gen-password helm charts
  shell: helm upgrade --install gen-password {{ charts_dir }}/gen-password -f /etc/kubernetes/plugins/gen-password/values.yaml
